"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const cssesc_1 = __importDefault(require("cssesc"));
function htmlTemplate({ templateId, templateName, externals, css, bundle, componentHash, hash, }) {
    return `function(model){
  oc.${templateName}Components = oc.${templateName}Components || {};
  oc.${templateName}Components['${componentHash}'] = oc.${templateName}Components['${componentHash}'] || (${bundle});
  if (!model) return;
  var modelHTML =  model.__html ? model.__html : '';
  var ssr = !!modelHTML;
  var externals = ${JSON.stringify(externals)};
  var staticPath = model.component.props._staticPath;
  if (ssr) {
    externals.push({
      global: ['oc', 'components', '${hash}'],
      url: staticPath + 'template.js',
      name: "template"
    });
  }
  var props = JSON.stringify(model.component.props);
  oc = oc || {};
  oc.__${templateName}Template = oc.__${templateName}Template || { count: 0 };
  var count = oc.__${templateName}Template.count;
  var templateId = "${templateId}-" + count;
  oc.__${templateName}Template.count++;
  var ssrCall = 'oc.components["${hash}"]({ component: { props:' + props + ' } });';

  return '<div id="' + templateId + '" class="${templateId}">' + modelHTML + '</div>' +
    '${css ? '<style>' + (0, cssesc_1.default)(css) + '</style>' : ''}' +
    '<script>' +
    'oc = oc || {};' +
    'oc.cmd = oc.cmd || [];' +
    'oc.cmd.push(function(oc){' +
    '${css ? "oc.events.fire(\\'oc:cssDidMount\\', \\'" + css + "\\');" : ''}' +
      'oc.requireSeries(' + JSON.stringify(externals) + ', function(){' +
        'var targetNode = document.getElementById("' + templateId + '");' +
        'targetNode.setAttribute("id","");' +
        (ssr ? ssrCall : '') +
        'oc.components["${hash}"]({ component: { props:' + props + ' } });' +
        'oc.${templateName}Components["${componentHash}"](' + props + ', targetNode, ' + !!modelHTML  + ');' +
      '});' +
    '});' +
  '</script>'
}`;
}
exports.default = htmlTemplate;
